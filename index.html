<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Ph√≤ng C∆° ƒêi·ªán</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            min-height: 600px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .status-bar {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .upload-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background 0.3s;
        }

        .upload-button:hover {
            background: #0056b3;
        }

        .chat-container {
            height: 400px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: linear-gradient(to bottom, #fafafa, #ffffff);
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }

        .ai-message {
            background: linear-gradient(135deg, #e9ecef, #f8f9fa);
            color: #2c3e50;
            border-left: 4px solid #007bff;
        }

        .error-message {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border-left: 4px solid #a71e2a;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #007bff;
        }

        .send-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .send-button:hover {
            transform: scale(1.05);
        }

        .send-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #007bff;
            font-style: italic;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .document-count {
            background: #17a2b8;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }

        .language-selector {
            margin-bottom: 20px;
            text-align: center;
        }

        .language-selector select {
            padding: 8px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .chat-container {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                ü§ñ AI Agent Ph√≤ng C∆° ƒêi·ªán
            </h1>
            <p>H·ªá th·ªëng h·ªó tr·ª£ k·ªπ thu·∫≠t th√¥ng minh cho nh√¢n vi√™n</p>
        </div>

        <div class="status-bar" id="statusBar">
            ‚úÖ H·ªá th·ªëng ƒë√£ s·∫µn s√†ng - K·∫øt n·ªëi Google Drive th√†nh c√¥ng
        </div>

        <div class="language-selector">
            <label for="languageSelect">üåê Ng√¥n ng·ªØ: </label>
            <select id="languageSelect">
                <option value="vi">Ti·∫øng Vi·ªát</option>
                <option value="en">English</option>
                <option value="zh">‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
            </select>
        </div>

        <div class="upload-section">
            <h3>üìÅ Qu·∫£n l√Ω T√†i li·ªáu</h3>
            <p>H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ƒë·ªìng b·ªô t√†i li·ªáu t·ª´ Google Drive</p>
            <button class="upload-button" onclick="syncDocuments()">üîÑ ƒê·ªìng b·ªô t√†i li·ªáu</button>
            <button class="upload-button" onclick="showDocuments()" style="background: #28a745;">üìã Xem danh s√°ch</button>
            <div class="document-count" id="docCount">üìä ƒê√£ t·∫£i: 0 t√†i li·ªáu</div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    üëã Xin ch√†o! T√¥i l√† AI Assistant c·ªßa ph√≤ng C∆° ƒêi·ªán. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n t√¨m ki·∫øm th√¥ng tin trong c√°c t√†i li·ªáu k·ªπ thu·∫≠t. H√£y ƒë·∫∑t c√¢u h·ªèi v·ªÅ:
                    <br>‚Ä¢ Quy tr√¨nh v·∫≠n h√†nh thi·∫øt b·ªã
                    <br>‚Ä¢ H∆∞·ªõng d·∫´n b·∫£o tr√¨
                    <br>‚Ä¢ Th√¥ng s·ªë k·ªπ thu·∫≠t
                    <br>‚Ä¢ X·ª≠ l√Ω s·ª± c·ªë
                    <br><br>üí° <strong>V√≠ d·ª•:</strong> "L√†m th·∫ø n√†o ƒë·ªÉ b·∫£o tr√¨ m√°y n√©n kh√≠?" ho·∫∑c "Th√¥ng s·ªë ƒëi·ªán √°p v·∫≠n h√†nh c·ªßa m√°y b∆°m l√† g√¨?"
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." onkeypress="handleKeyPress(event)">
                <button class="send-button" id="sendButton" onclick="sendMessage()">üì§ G·ª≠i</button>
            </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh h·ªá th·ªëng
        const CONFIG = {
            openaiApiKey: 'YOUR_OPENAI_API_KEY', // Thay th·∫ø b·∫±ng API key c·ªßa b·∫°n
            googleDriveFolder: 'https://drive.google.com/drive/folders/1uIrX9anqJGZUZttJHWQJR3iTIkNkWnn1',
            maxTokens: 2000,
            temperature: 0.1
        };

        // Bi·∫øn global
        let documents = [];
        let documentEmbeddings = [];
        let isProcessing = false;
        let currentLanguage = 'vi';

        // Kh·ªüi t·∫°o h·ªá th·ªëng khi trang ƒë∆∞·ª£c t·∫£i
        window.addEventListener('load', function() {
            initializeSystem();
            updateDocumentCount();
        });

        async function initializeSystem() {
            try {
                updateStatus('üîÑ ƒêang kh·ªüi t·∫°o h·ªá th·ªëng...', '#ffc107');
                
                // M√¥ ph·ªèng vi·ªác t·∫£i t√†i li·ªáu t·ª´ Google Drive
                await simulateDocumentLoad();
                
                updateStatus('‚úÖ H·ªá th·ªëng ƒë√£ s·∫µn s√†ng - K·∫øt n·ªëi Google Drive th√†nh c√¥ng', '#28a745');
            } catch (error) {
                updateStatus('‚ùå L·ªói kh·ªüi t·∫°o: ' + error.message, '#dc3545');
            }
        }

        async function simulateDocumentLoad() {
            // M√¥ ph·ªèng d·ªØ li·ªáu t√†i li·ªáu m·∫´u
            const sampleDocuments = [
                {
                    name: "H∆∞·ªõng d·∫´n b·∫£o tr√¨ m√°y n√©n kh√≠.pdf",
                    content: "Quy tr√¨nh b·∫£o tr√¨ m√°y n√©n kh√≠: 1. Ki·ªÉm tra √°p su·∫•t h√†ng ng√†y 2. Thay d·∫ßu m·ªói 500 gi·ªù v·∫≠n h√†nh 3. V·ªá sinh l·ªçc kh√≠ h√†ng tu·∫ßn 4. Ki·ªÉm tra van an to√†n ƒë·ªãnh k·ª≥",
                    type: "maintenance",
                    language: "vi"
                },
                {
                    name: "Th√¥ng s·ªë k·ªπ thu·∫≠t m√°y b∆°m n∆∞·ªõc.docx",
                    content: "M√°y b∆°m n∆∞·ªõc ly t√¢m: C√¥ng su·∫•t 5.5kW, ƒëi·ªán √°p 380V, l∆∞u l∆∞·ª£ng 50m3/h, c·ªôt √°p 32m, t·ªëc ƒë·ªô 2900 v√≤ng/ph√∫t",
                    type: "specification",
                    language: "vi"
                },
                {
                    name: "Quy tr√¨nh x·ª≠ l√Ω s·ª± c·ªë ƒëi·ªán.pdf",
                    content: "Khi g·∫∑p s·ª± c·ªë m·∫•t ƒëi·ªán: 1. Ki·ªÉm tra c·∫ßu dao t·ªïng 2. Ki·ªÉm tra c√°c aptomat 3. ƒêo ƒëi·ªán √°p ƒë·∫ßu v√†o 4. Li√™n h·ªá k·ªπ s∆∞ ƒëi·ªán n·∫øu c·∫ßn thi·∫øt",
                    type: "troubleshooting",
                    language: "vi"
                }
            ];

            documents = sampleDocuments;
            
            // T·∫°o embeddings cho t√†i li·ªáu
            for (let doc of documents) {
                const embedding = await createEmbedding(doc.content);
                documentEmbeddings.push({
                    document: doc,
                    embedding: embedding
                });
            }
            
            updateDocumentCount();
        }

        async function createEmbedding(text) {
            // M√¥ ph·ªèng embedding ƒë∆°n gi·∫£n (trong th·ª±c t·∫ø s·∫Ω d√πng OpenAI API)
            return Array.from({length: 1536}, () => Math.random());
        }

        async function syncDocuments() {
            if (isProcessing) return;
            
            isProcessing = true;
            updateStatus('üîÑ ƒêang ƒë·ªìng b·ªô t√†i li·ªáu t·ª´ Google Drive...', '#ffc107');
            
            try {
                // M√¥ ph·ªèng qu√° tr√¨nh ƒë·ªìng b·ªô
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Th√™m m·ªôt t√†i li·ªáu m·ªõi ƒë·ªÉ m√¥ ph·ªèng
                const newDoc = {
                    name: "H∆∞·ªõng d·∫´n v·∫≠n h√†nh h·ªá th·ªëng HVAC.pdf",
                    content: "H·ªá th·ªëng ƒëi·ªÅu h√≤a kh√¥ng kh√≠: Nhi·ªát ƒë·ªô v·∫≠n h√†nh 22-25¬∞C, ƒë·ªô ·∫©m 50-60%, √°p su·∫•t kh√¥ng kh√≠ d∆∞∆°ng, thay l·ªçc kh√¥ng kh√≠ 3 th√°ng m·ªôt l·∫ßn",
                    type: "operation",
                    language: "vi"
                };
                
                documents.push(newDoc);
                const embedding = await createEmbedding(newDoc.content);
                documentEmbeddings.push({
                    document: newDoc,
                    embedding: embedding
                });
                
                updateDocumentCount();
                updateStatus('‚úÖ ƒê·ªìng b·ªô th√†nh c√¥ng - ƒê√£ c·∫≠p nh·∫≠t t√†i li·ªáu m·ªõi', '#28a745');
                
            } catch (error) {
                updateStatus('‚ùå L·ªói ƒë·ªìng b·ªô: ' + error.message, '#dc3545');
            } finally {
                isProcessing = false;
            }
        }

        function showDocuments() {
            const docList = documents.map(doc => `üìÑ ${doc.name}`).join('\n');
            addMessage(`üìã Danh s√°ch t√†i li·ªáu hi·ªán c√≥:\n\n${docList}`, 'ai-message');
        }

        function updateDocumentCount() {
            document.getElementById('docCount').textContent = `üìä ƒê√£ t·∫£i: ${documents.length} t√†i li·ªáu`;
        }

        function updateStatus(message, color) {
            const statusBar = document.getElementById('statusBar');
            statusBar.textContent = message;
            statusBar.style.background = color;
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;
            
            input.value = '';
            addMessage(message, 'user-message');
            
            isProcessing = true;
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            sendButton.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
            
            // Hi·ªÉn th·ªã loading
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai-message loading';
            loadingDiv.innerHTML = '<div class="spinner"></div> ƒêang t√¨m ki·∫øm th√¥ng tin...';
            document.getElementById('chatMessages').appendChild(loadingDiv);
            scrollToBottom();
            
            try {
                const response = await processQuery(message);
                loadingDiv.remove();
                addMessage(response, 'ai-message');
            } catch (error) {
                loadingDiv.remove();
                addMessage('‚ùå Xin l·ªói, ƒë√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω c√¢u h·ªèi c·ªßa b·∫°n: ' + error.message, 'error-message');
            } finally {
                isProcessing = false;
                sendButton.disabled = false;
                sendButton.textContent = 'üì§ G·ª≠i';
            }
        }

        async function processQuery(query) {
            try {
                // T√¨m ki·∫øm t√†i li·ªáu li√™n quan
                const relevantDocs = await searchRelevantDocuments(query);
                
                if (relevantDocs.length === 0) {
                    return `‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin li√™n quan ƒë·∫øn c√¢u h·ªèi: "${query}"\n\nüí° G·ª£i √Ω:\n‚Ä¢ Th·ª≠ ƒë·∫∑t c√¢u h·ªèi kh√°c c√°ch\n‚Ä¢ Ki·ªÉm tra xem t√†i li·ªáu c√≥ trong h·ªá th·ªëng kh√¥ng\n‚Ä¢ Li√™n h·ªá b·ªô ph·∫≠n k·ªπ thu·∫≠t n·∫øu c·∫ßn h·ªó tr·ª£ th√™m`;
                }
                
                // T·∫°o context t·ª´ c√°c t√†i li·ªáu li√™n quan
                const context = relevantDocs.map(doc => 
                    `T√†i li·ªáu: ${doc.document.name}\nN·ªôi dung: ${doc.document.content}`
                ).join('\n\n');
                
                // T·∫°o prompt cho OpenAI
                const prompt = createPrompt(query, context, currentLanguage);
                
                // M√¥ ph·ªèng ph·∫£n h·ªìi t·ª´ AI (trong th·ª±c t·∫ø s·∫Ω g·ªçi OpenAI API)
                const response = await simulateAIResponse(query, relevantDocs);
                
                return response;
                
            } catch (error) {
                throw new Error('L·ªói x·ª≠ l√Ω truy v·∫•n: ' + error.message);
            }
        }

        async function searchRelevantDocuments(query) {
            // M√¥ ph·ªèng t√¨m ki·∫øm vector
            const queryEmbedding = await createEmbedding(query);
            
            const similarities = documentEmbeddings.map(docEmb => ({
                document: docEmb.document,
                similarity: calculateSimilarity(queryEmbedding, docEmb.embedding)
            }));
            
            // S·∫Øp x·∫øp theo ƒë·ªô t∆∞∆°ng t·ª± v√† l·∫•y top 3
            return similarities
                .sort((a, b) => b.similarity - a.similarity)
                .slice(0, 3)
                .filter(item => item.similarity > 0.5); // Ng∆∞·ª°ng t∆∞∆°ng t·ª± t·ªëi thi·ªÉu
        }

        function calculateSimilarity(vec1, vec2) {
            // T√≠nh cosine similarity ƒë∆°n gi·∫£n
            const dotProduct = vec1.reduce((sum, a, i) => sum + a * vec2[i], 0);
            const normA = Math.sqrt(vec1.reduce((sum, a) => sum + a * a, 0));
            const normB = Math.sqrt(vec2.reduce((sum, b) => sum + b * b, 0));
            return dotProduct / (normA * normB);
        }

        function createPrompt(query, context, language) {
            const prompts = {
                vi: `B·∫°n l√† m·ªôt chuy√™n gia k·ªπ thu·∫≠t c∆° ƒëi·ªán. D·ª±a v√†o th√¥ng tin sau ƒë√¢y, h√£y tr·∫£ l·ªùi c√¢u h·ªèi m·ªôt c√°ch ch√≠nh x√°c v√† chi ti·∫øt.

Th√¥ng tin t√†i li·ªáu:
${context}

C√¢u h·ªèi: ${query}

Y√™u c·∫ßu:
- Ch·ªâ tr·∫£ l·ªùi d·ª±a tr√™n th√¥ng tin c√≥ trong t√†i li·ªáu
- N·∫øu kh√¥ng c√≥ th√¥ng tin, h√£y n√≥i r√µ "Kh√¥ng t√¨m th·∫•y th√¥ng tin"
- ƒê∆∞a ra c√¢u tr·∫£ l·ªùi chi ti·∫øt v√† th·ª±c t·∫ø
- S·ª≠ d·ª•ng ti·∫øng Vi·ªát`,
                
                en: `You are a mechanical-electrical engineering expert. Based on the following information, answer the question accurately and in detail.

Document information:
${context}

Question: ${query}

Requirements:
- Only answer based on information in the documents
- If no information is found, clearly state "Information not found"
- Provide detailed and practical answers
- Use English`,
                
                zh: `ÊÇ®ÊòØÊú∫ÁîµÂ∑•Á®ã‰∏ìÂÆ∂„ÄÇÊ†πÊçÆ‰ª•‰∏ã‰ø°ÊÅØÔºåÂáÜÁ°ÆËØ¶ÁªÜÂú∞ÂõûÁ≠îÈóÆÈ¢ò„ÄÇ

ÊñáÊ°£‰ø°ÊÅØÔºö
${context}

ÈóÆÈ¢òÔºö${query}

Ë¶ÅÊ±ÇÔºö
- ‰ªÖÊ†πÊçÆÊñáÊ°£‰∏≠ÁöÑ‰ø°ÊÅØÂõûÁ≠î
- Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞‰ø°ÊÅØÔºåËØ∑ÊòéÁ°ÆËØ¥Êòé"Êú™ÊâæÂà∞‰ø°ÊÅØ"
- Êèê‰æõËØ¶ÁªÜÂíåÂÆûÁî®ÁöÑÁ≠îÊ°à
- ‰ΩøÁî®‰∏≠Êñá`
            };
            
            return prompts[language] || prompts.vi;
        }

        async function simulateAIResponse(query, relevantDocs) {
            // M√¥ ph·ªèng ph·∫£n h·ªìi th√¥ng minh d·ª±a tr√™n t·ª´ kh√≥a
            const queryLower = query.toLowerCase();
            
            if (queryLower.includes('m√°y n√©n kh√≠') || queryLower.includes('n√©n kh√≠')) {
                return `üîß **Th√¥ng tin v·ªÅ m√°y n√©n kh√≠:**\n\nD·ª±a v√†o t√†i li·ªáu "H∆∞·ªõng d·∫´n b·∫£o tr√¨ m√°y n√©n kh√≠.pdf", t√¥i t√¨m th·∫•y th√¥ng tin sau:\n\n**Quy tr√¨nh b·∫£o tr√¨:**\n‚Ä¢ Ki·ªÉm tra √°p su·∫•t h√†ng ng√†y\n‚Ä¢ Thay d·∫ßu m·ªói 500 gi·ªù v·∫≠n h√†nh\n‚Ä¢ V·ªá sinh l·ªçc kh√≠ h√†ng tu·∫ßn\n‚Ä¢ Ki·ªÉm tra van an to√†n ƒë·ªãnh k·ª≥\n\n‚ö†Ô∏è **L∆∞u √Ω:** Lu√¥n tu√¢n th·ªß c√°c quy tr√¨nh an to√†n khi l√†m vi·ªác v·ªõi thi·∫øt b·ªã √°p su·∫•t cao.`;
            }
            
            if (queryLower.includes('m√°y b∆°m') || queryLower.includes('b∆°m n∆∞·ªõc')) {
                return `üíß **Th√¥ng s·ªë k·ªπ thu·∫≠t m√°y b∆°m n∆∞·ªõc:**\n\nT·ª´ t√†i li·ªáu "Th√¥ng s·ªë k·ªπ thu·∫≠t m√°y b∆°m n∆∞·ªõc.docx":\n\n**Th√¥ng s·ªë ch√≠nh:**\n‚Ä¢ Lo·∫°i: M√°y b∆°m n∆∞·ªõc ly t√¢m\n‚Ä¢ C√¥ng su·∫•t: 5.5kW\n‚Ä¢ ƒêi·ªán √°p: 380V\n‚Ä¢ L∆∞u l∆∞·ª£ng: 50m¬≥/h\n‚Ä¢ C·ªôt √°p: 32m\n‚Ä¢ T·ªëc ƒë·ªô: 2900 v√≤ng/ph√∫t\n\nüìã **·ª®ng d·ª•ng:** Ph√π h·ª£p cho c√°c h·ªá th·ªëng c·∫•p n∆∞·ªõc c√¥ng nghi·ªáp.`;
            }
            
            if (queryLower.includes('s·ª± c·ªë') || queryLower.includes('m·∫•t ƒëi·ªán') || queryLower.includes('ƒëi·ªán')) {
                return `‚ö° **Quy tr√¨nh x·ª≠ l√Ω s·ª± c·ªë ƒëi·ªán:**\n\nTheo t√†i li·ªáu "Quy tr√¨nh x·ª≠ l√Ω s·ª± c·ªë ƒëi·ªán.pdf":\n\n**C√°c b∆∞·ªõc x·ª≠ l√Ω khi m·∫•t ƒëi·ªán:**\n1. ‚úÖ Ki·ªÉm tra c·∫ßu dao t·ªïng\n2. ‚úÖ Ki·ªÉm tra c√°c aptomat\n3. ‚úÖ ƒêo ƒëi·ªán √°p ƒë·∫ßu v√†o\n4. ‚úÖ Li√™n h·ªá k·ªπ s∆∞ ƒëi·ªán n·∫øu c·∫ßn thi·∫øt\n\nüö® **C·∫£nh b√°o:** Ch·ªâ nh·ªØng ng∆∞·ªùi c√≥ chuy√™n m√¥n m·ªõi ƒë∆∞·ª£c th·ª±c hi·ªán c√°c thao t√°c tr√™n h·ªá th·ªëng ƒëi·ªán.`;
            }
            
            if (queryLower.includes('hvac') || queryLower.includes('ƒëi·ªÅu h√≤a') || queryLower.includes('kh√¥ng kh√≠')) {
                return `‚ùÑÔ∏è **H∆∞·ªõng d·∫´n v·∫≠n h√†nh h·ªá th·ªëng HVAC:**\n\nT·ª´ t√†i li·ªáu "H∆∞·ªõng d·∫´n v·∫≠n h√†nh h·ªá th·ªëng HVAC.pdf":\n\n**Th√¥ng s·ªë v·∫≠n h√†nh:**\n‚Ä¢ Nhi·ªát ƒë·ªô: 22-25¬∞C\n‚Ä¢ ƒê·ªô ·∫©m: 50-60%\n‚Ä¢ √Åp su·∫•t kh√¥ng kh√≠: D∆∞∆°ng √°p\n‚Ä¢ B·∫£o tr√¨ l·ªçc: 3 th√°ng/l·∫ßn\n\nüí° **G·ª£i √Ω:** Ki·ªÉm tra ƒë·ªãnh k·ª≥ ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t t·ªëi ∆∞u.`;
            }
            
            // Ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh
            return `üìö T√¥i ƒë√£ t√¨m ki·∫øm trong ${documents.length} t√†i li·ªáu c√≥ s·∫µn nh∆∞ng kh√¥ng t√¨m th·∫•y th√¥ng tin c·ª• th·ªÉ v·ªÅ c√¢u h·ªèi: "${query}"\n\nüí° **G·ª£i √Ω:**\n‚Ä¢ Th·ª≠ ƒë·∫∑t c√¢u h·ªèi kh√°c c√°ch ho·∫∑c s·ª≠ d·ª•ng t·ª´ kh√≥a kh√°c\n‚Ä¢ Ki·ªÉm tra xem t√†i li·ªáu li√™n quan ƒë√£ ƒë∆∞·ª£c t·∫£i l√™n Google Drive ch∆∞a\n‚Ä¢ Li√™n h·ªá v·ªõi b·ªô ph·∫≠n k·ªπ thu·∫≠t ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ th√™m\n\nüìã **C√°c ch·ªß ƒë·ªÅ t√¥i c√≥ th·ªÉ h·ªó tr·ª£:**\n‚Ä¢ M√°y n√©n kh√≠ v√† b·∫£o tr√¨\n‚Ä¢ M√°y b∆°m n∆∞·ªõc v√† th√¥ng s·ªë k·ªπ thu·∫≠t\n‚Ä¢ X·ª≠ l√Ω s·ª± c·ªë ƒëi·ªán\n‚Ä¢ H·ªá th·ªëng HVAC v√† ƒëi·ªÅu h√≤a kh√¥ng kh√≠`;
        }

        function addMessage(message, className) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.innerHTML = message.replace(/\n/g, '<br>');
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // X·ª≠ l√Ω thay ƒë·ªïi ng√¥n ng·ªØ
        document.getElementById('languageSelect').addEventListener('change', function(e) {
            currentLanguage = e.target.value;
            updateLanguage();
        });

        function updateLanguage() {
            const translations = {
                vi: {
                    welcome: "üëã Xin ch√†o! T√¥i l√† AI Assistant c·ªßa ph√≤ng C∆° ƒêi·ªán...",
                    placeholder: "Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...",
                    sendButton: "üì§ G·ª≠i"
                },
                en: {
                    welcome: "üëã Hello! I'm the AI Assistant for the Mechanical-Electrical Department...",
                    placeholder: "Enter your question...",
                    sendButton: "üì§ Send"
                },
                zh: {
                    welcome: "üëã ÊÇ®Â•ΩÔºÅÊàëÊòØÊú∫ÁîµÈÉ®Èó®ÁöÑAIÂä©Êâã...",
                    placeholder: "ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢ò...",
                    sendButton: "üì§ ÂèëÈÄÅ"
                }
            };
            
            const lang = translations[currentLanguage] || translations.vi;
            document.getElementById('chatInput').placeholder = lang.placeholder;
            document.getElementById('sendButton').textContent = lang.sendButton;
        }

        // X·ª≠ l√Ω upload file (m·ªü r·ªông trong t∆∞∆°ng lai)
        function handleFileUpload() {
            // S·∫Ω ƒë∆∞·ª£c tri·ªÉn khai ƒë·ªÉ upload tr·ª±c ti·∫øp l√™n Google Drive API
            alert('T√≠nh nƒÉng n√†y s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn ƒë·ªÉ t√≠ch h·ª£p v·ªõi Google Drive API');
        }

        // Auto-save conversation (t√πy ch·ªçn)
        function saveConversation() {
            const messages = Array.from(document.querySelectorAll('.message')).map(msg => ({
                content: msg.textContent,
                type: msg.className.includes('user-message') ? 'user' : 'ai',
                timestamp: new Date().toISOString()
            }));
            
            // L∆∞u v√†o localStorage ho·∫∑c g·ª≠i l√™n server
            console.log('Conversation saved:', messages);
        }
    </script>
</body>
</html>