<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent - H·ªó Tr·ª£ K·ªπ Thu·∫≠t C∆° ƒêi·ªán</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 600px;
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #dee2e6;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .config-section {
            background: #e9ecef;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px dashed #6c757d;
        }

        .config-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b8daff;
        }

        .chat-messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px 20px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .message.user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            background: white;
            color: #333;
            border: 1px solid #dee2e6;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .message.ai .sources {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
            font-size: 0.9em;
            color: #6c757d;
        }

        .chat-input {
            padding: 30px;
            background: white;
            border-top: 1px solid #dee2e6;
        }

        .input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn {
            padding: 15px 30px;
            border-radius: 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .docs-info {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border-left: 4px solid #28a745;
        }

        .docs-info h3 {
            color: #28a745;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .message {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Agent H·ªó Tr·ª£ K·ªπ Thu·∫≠t</h1>
            <p>Tra c·ª©u t√†i li·ªáu n·ªôi b·ªô Ph√≤ng C∆° ƒêi·ªán</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="config-section">
                    <h3>‚öôÔ∏è C·∫•u H√¨nh API</h3>
                    
                    <div class="input-group">
                        <label for="openaiKey">OpenAI API Key:</label>
                        <input type="password" id="openaiKey" placeholder="sk-..." />
                    </div>

                    <div class="input-group">
                        <label for="googleKey">Google Drive API Key:</label>
                        <input type="password" id="googleKey" placeholder="AIza..." />
                    </div>

                    <div class="input-group">
                        <label for="language">Ng√¥n ng·ªØ:</label>
                        <select id="language">
                            <option value="vi">Ti·∫øng Vi·ªát</option>
                            <option value="en">English</option>
                            <option value="zh">‰∏≠Êñá</option>
                            <option value="ja">Êó•Êú¨Ë™û</option>
                        </select>
                    </div>

                    <button class="btn" onclick="initializeSystem()">üîÑ Kh·ªüi T·∫°o H·ªá Th·ªëng</button>
                    
                    <div id="systemStatus"></div>
                </div>

                <div class="docs-info">
                    <h3>üìÅ Th√¥ng Tin T√†i Li·ªáu</h3>
                    <p><strong>Ngu·ªìn:</strong> Google Drive</p>
                    <p><strong>ƒê·ªãnh d·∫°ng:</strong> PDF, DOCX</p>
                    <p><strong>C·∫≠p nh·∫≠t:</strong> T·ª± ƒë·ªông</p>
                    <div id="docsCount">ƒêang t·∫£i...</div>
                </div>

                <div class="config-section">
                    <h3>üîç T√¨m Ki·∫øm Th√¥ng Minh</h3>
                    <p style="font-size: 0.9em; color: #6c757d; line-height: 1.4;">
                        ‚Ä¢ Vector Search v·ªõi AI Embeddings<br>
                        ‚Ä¢ T√¨m ki·∫øm ng·ªØ nghƒ©a<br>
                        ‚Ä¢ H·ªó tr·ª£ ƒëa ng√¥n ng·ªØ<br>
                        ‚Ä¢ Kh√¥ng b·ªãa ƒë·∫∑t th√¥ng tin
                    </p>
                </div>
            </div>

            <div class="chat-area">
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <strong>ü§ñ AI Agent:</strong> Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI c·ªßa ph√≤ng C∆° ƒêi·ªán. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n tra c·ª©u c√°c t√†i li·ªáu k·ªπ thu·∫≠t n·ªôi b·ªô.<br><br>
                        <strong>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</strong><br>
                        1. Nh·∫≠p API Keys v√†o b√™n tr√°i<br>
                        2. Nh·∫•n "Kh·ªüi T·∫°o H·ªá Th·ªëng"<br>
                        3. ƒê·∫∑t c√¢u h·ªèi v·ªÅ t√†i li·ªáu k·ªπ thu·∫≠t<br><br>
                        <em>L∆∞u √Ω: T√¥i ch·ªâ tr·∫£ l·ªùi d·ª±a tr√™n t√†i li·ªáu c√≥ s·∫µn v√† s·∫Ω th√¥ng b√°o n·∫øu kh√¥ng t√¨m th·∫•y th√¥ng tin.</em>
                    </div>
                </div>

                <div class="chat-input">
                    <div class="input-container">
                        <input 
                            type="text" 
                            id="messageInput" 
                            placeholder="ƒê·∫∑t c√¢u h·ªèi v·ªÅ t√†i li·ªáu k·ªπ thu·∫≠t..." 
                            onkeypress="handleKeyPress(event)"
                        />
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
                            G·ª≠i
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === C·∫§U H√åNH API - THAY ƒê·ªîI T·∫†I ƒê√ÇY ===
        let CONFIG = {
            openaiApiKey: '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', // Nh·∫≠p OpenAI API key t·∫°i ƒë√¢y ho·∫∑c qua giao di·ªán
            googleApiKey: 'AIzaSyD5uBLWsQL6z-B_yPrJXIk2fbxMXehR8fU', // Nh·∫≠p Google Drive API key t·∫°i ƒë√¢y ho·∫∑c qua giao di·ªán
            folderId: '1uIrX9anqJGZUZttJHWQJR3iTIkNkWnn1', // ID th∆∞ m·ª•c Google Drive
            model: 'gpt-4',
            maxTokens: 1000,
            temperature: 0.1 // Th·∫•p ƒë·ªÉ gi·∫£m thi·ªÉu b·ªãa ƒë·∫∑t
        };

        // Tr·∫°ng th√°i h·ªá th·ªëng
        let systemState = {
            initialized: false,
            documents: [],
            embeddings: new Map(),
            currentLanguage: 'vi'
        };

        // T·ª´ ƒëi·ªÉn ƒëa ng√¥n ng·ªØ
        const TRANSLATIONS = {
            vi: {
                systemReady: "‚úÖ H·ªá th·ªëng ƒë√£ s·∫µn s√†ng! T√¨m th·∫•y {count} t√†i li·ªáu.",
                systemError: "‚ùå L·ªói kh·ªüi t·∫°o: {error}",
                loading: "‚è≥ ƒêang x·ª≠ l√Ω...",
                notFound: "‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin li√™n quan trong t√†i li·ªáu.",
                apiError: "‚ùå Vui l√≤ng nh·∫≠p API Keys tr∆∞·ªõc.",
                searching: "üîç ƒêang t√¨m ki·∫øm t√†i li·ªáu...",
                processingDocs: "üìÑ ƒêang x·ª≠ l√Ω t√†i li·ªáu..."
            },
            en: {
                systemReady: "‚úÖ System ready! Found {count} documents.",
                systemError: "‚ùå Initialization error: {error}",
                loading: "‚è≥ Processing...",
                notFound: "‚ùå No relevant information found in documents.",
                apiError: "‚ùå Please enter API Keys first.",
                searching: "üîç Searching documents...",
                processingDocs: "üìÑ Processing documents..."
            }
        };

        // H√†m l·∫•y text theo ng√¥n ng·ªØ
        function getText(key, params = {}) {
            let text = TRANSLATIONS[systemState.currentLanguage]?.[key] || TRANSLATIONS.vi[key];
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            return text;
        }

        // Kh·ªüi t·∫°o h·ªá th·ªëng
        async function initializeSystem() {
            const openaiKey = document.getElementById('openaiKey').value || CONFIG.openaiApiKey;
            const googleKey = document.getElementById('googleKey').value || CONFIG.googleApiKey;
            const language = document.getElementById('language').value;

            if (!openaiKey || !googleKey) {
                showStatus('error', getText('apiError'));
                return;
            }

            CONFIG.openaiApiKey = openaiKey;
            CONFIG.googleApiKey = googleKey;
            systemState.currentLanguage = language;

            showStatus('loading', getText('loading'));

            try {
                // 1. L·∫•y danh s√°ch t√†i li·ªáu t·ª´ Google Drive
                await loadDocumentsFromDrive();
                
                // 2. T·∫°o embeddings cho t√†i li·ªáu
                await createDocumentEmbeddings();
                
                // 3. Ho√†n th√†nh kh·ªüi t·∫°o
                systemState.initialized = true;
                document.getElementById('sendBtn').disabled = false;
                
                showStatus('success', getText('systemReady', {count: systemState.documents.length}));
                updateDocsCount();

            } catch (error) {
                console.error('Initialization error:', error);
                showStatus('error', getText('systemError', {error: error.message}));
            }
        }

        // T·∫£i t√†i li·ªáu t·ª´ Google Drive
        async function loadDocumentsFromDrive() {
            showStatus('loading', getText('processingDocs'));
            
            // G·ªçi Google Drive API ƒë·ªÉ l·∫•y danh s√°ch file
            const response = await fetch(`https://www.googleapis.com/drive/v3/files?q='${CONFIG.folderId}'+in+parents&key=${CONFIG.googleApiKey}`);
            
            if (!response.ok) {
                throw new Error('Kh√¥ng th·ªÉ k·∫øt n·ªëi Google Drive API');
            }

            const data = await response.json();
            systemState.documents = [];

            for (const file of data.files) {
                if (file.mimeType === 'application/pdf' || file.mimeType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                    try {
                        const content = await extractFileContent(file.id, file.mimeType);
                        systemState.documents.push({
                            id: file.id,
                            name: file.name,
                            content: content,
                            mimeType: file.mimeType
                        });
                    } catch (error) {
                        console.error(`Error processing file ${file.name}:`, error);
                    }
                }
            }
        }

        // Tr√≠ch xu·∫•t n·ªôi dung file (gi·∫£ l·∫≠p - c·∫ßn API th·ª±c t·∫ø)
        async function extractFileContent(fileId, mimeType) {
            // Trong th·ª±c t·∫ø, b·∫°n c·∫ßn s·ª≠ d·ª•ng:
            // - PDF: PDF.js ho·∫∑c API chuy·ªÉn ƒë·ªïi
            // - DOCX: mammoth.js ho·∫∑c API chuy·ªÉn ƒë·ªïi
            
            // ƒê√¢y l√† m√¥ ph·ªèng n·ªôi dung ƒë·ªÉ demo
            const sampleContents = [
                "H∆∞·ªõng d·∫´n b·∫£o tr√¨ m√°y m√≥c c∆° ƒëi·ªán. Quy tr√¨nh ki·ªÉm tra ƒë·ªãnh k·ª≥ thi·∫øt b·ªã ƒëi·ªán. C√°c bi·ªán ph√°p an to√†n lao ƒë·ªông.",
                "Quy tr√¨nh v·∫≠n h√†nh h·ªá th·ªëng ƒëi·ªán c√¥ng nghi·ªáp. Ki·ªÉm tra v√† b·∫£o d∆∞·ª°ng ƒë·ªông c∆°. X·ª≠ l√Ω s·ª± c·ªë ƒëi·ªán.",
                "Ti√™u chu·∫©n k·ªπ thu·∫≠t l·∫Øp ƒë·∫∑t thi·∫øt b·ªã c∆° ƒëi·ªán. Quy ƒë·ªãnh v·ªÅ an to√†n ƒëi·ªán. H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng.",
                "B·∫£o tr√¨ h·ªá th·ªëng t·ª± ƒë·ªông h√≥a. Ki·ªÉm tra PLC v√† HMI. Quy tr√¨nh backup d·ªØ li·ªáu.",
                "K·ªπ thu·∫≠t s·ª≠a ch·ªØa thi·∫øt b·ªã c∆° kh√≠. Thay th·∫ø linh ki·ªán. Hi·ªáu chu·∫©n thi·∫øt b·ªã ƒëo."
            ];
            
            return sampleContents[Math.floor(Math.random() * sampleContents.length)];
        }

        // T·∫°o embeddings cho t√†i li·ªáu
        async function createDocumentEmbeddings() {
            for (const doc of systemState.documents) {
                const chunks = splitTextIntoChunks(doc.content, 500);
                
                for (const chunk of chunks) {
                    const embedding = await createEmbedding(chunk);
                    const key = `${doc.id}_${chunks.indexOf(chunk)}`;
                    systemState.embeddings.set(key, {
                        embedding: embedding,
                        text: chunk,
                        docName: doc.name,
                        docId: doc.id
                    });
                }
            }
        }

        // Chia text th√†nh chunks
        function splitTextIntoChunks(text, chunkSize) {
            const chunks = [];
            for (let i = 0; i < text.length; i += chunkSize) {
                chunks.push(text.slice(i, i + chunkSize));
            }
            return chunks;
        }

        // T·∫°o embedding b·∫±ng OpenAI
        async function createEmbedding(text) {
            const response = await fetch('https://api.openai.com/v1/embeddings', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${CONFIG.openaiApiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'text-embedding-ada-002',
                    input: text
                })
            });

            if (!response.ok) {
                throw new Error('L·ªói t·∫°o embedding');
            }

            const data = await response.json();
            return data.data[0].embedding;
        }

        // T√≠nh ƒë·ªô t∆∞∆°ng ƒë·ªìng cosine
        function cosineSimilarity(a, b) {
            const dotProduct = a.reduce((sum, ai, i) => sum + ai * b[i], 0);
            const normA = Math.sqrt(a.reduce((sum, ai) => sum + ai * ai, 0));
            const normB = Math.sqrt(b.reduce((sum, bi) => sum + bi * bi, 0));
            return dotProduct / (normA * normB);
        }

        // T√¨m ki·∫øm vector
        async function vectorSearch(query, topK = 5) {
            const queryEmbedding = await createEmbedding(query);
            const results = [];

            for (const [key, data] of systemState.embeddings) {
                const similarity = cosineSimilarity(queryEmbedding, data.embedding);
                results.push({
                    similarity: similarity,
                    text: data.text,
                    docName: data.docName,
                    docId: data.docId
                });
            }

            return results.sort((a, b) => b.similarity - a.similarity).slice(0, topK);
        }

        // G·ª≠i tin nh·∫Øn
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || !systemState.initialized) return;

            input.value = '';
            document.getElementById('sendBtn').disabled = true;

            // Hi·ªÉn th·ªã tin nh·∫Øn user
            addMessage('user', message);

            try {
                showTyping();
                
                // 1. Vector search
                const searchResults = await vectorSearch(message);
                
                if (searchResults.length === 0 || searchResults[0].similarity < 0.3) {
                    addMessage('ai', getText('notFound'));
                    return;
                }

                // 2. T·∫°o context t·ª´ k·∫øt qu·∫£ t√¨m ki·∫øm
                const context = searchResults.slice(0, 3).map(r => r.text).join('\n\n');
                
                // 3. G·ªçi OpenAI ƒë·ªÉ tr·∫£ l·ªùi
                const answer = await generateAnswer(message, context);
                
                // 4. Hi·ªÉn th·ªã k·∫øt qu·∫£
                const sources = [...new Set(searchResults.slice(0, 3).map(r => r.docName))];
                addMessage('ai', answer, sources);

            } catch (error) {
                console.error('Error:', error);
                addMessage('ai', '‚ùå ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω c√¢u h·ªèi.');
            } finally {
                hideTyping();
                document.getElementById('sendBtn').disabled = false;
            }
        }

        // T·∫°o c√¢u tr·∫£ l·ªùi b·∫±ng OpenAI
        async function generateAnswer(question, context) {
            const systemPrompt = `B·∫°n l√† m·ªôt tr·ª£ l√Ω AI chuy√™n v·ªÅ k·ªπ thu·∫≠t c∆° ƒëi·ªán. H√£y tr·∫£ l·ªùi c√¢u h·ªèi d·ª±a CH√çNH X√ÅC tr√™n th√¥ng tin ƒë∆∞·ª£c cung c·∫•p trong context. 

QUAN TR·ªåNG:
- CH·ªà s·ª≠ d·ª•ng th√¥ng tin c√≥ trong context
- KH√îNG b·ªãa ƒë·∫∑t ho·∫∑c th√™m th√¥ng tin t·ª´ ki·∫øn th·ª©c chung
- N·∫øu context kh√¥ng c√≥ th√¥ng tin c·∫ßn thi·∫øt, h√£y n√≥i "Kh√¥ng t√¨m th·∫•y th√¥ng tin li√™n quan"
- Tr·∫£ l·ªùi b·∫±ng ng√¥n ng·ªØ ${systemState.currentLanguage}
- Tr·∫£ l·ªùi ng·∫Øn g·ªçn, r√µ r√†ng v√† chuy√™n nghi·ªáp

Context: ${context}`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${CONFIG.openaiApiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: CONFIG.model,
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: question }
                    ],
                    max_tokens: CONFIG.maxTokens,
                    temperature: CONFIG.temperature
                })
            });

            if (!response.ok) {
                throw new Error('L·ªói g·ªçi OpenAI API');
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Th√™m tin nh·∫Øn v√†o chat
        function addMessage(sender, content, sources = []) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            let sourceHtml = '';
            if (sources && sources.length > 0) {
                sourceHtml = `<div class="sources"><strong>üìÅ Ngu·ªìn t√†i li·ªáu:</strong> ${sources.join(', ')}</div>`;
            }

            messageDiv.innerHTML = `
                <strong>${sender === 'user' ? 'üë§ B·∫°n' : 'ü§ñ AI Agent'}:</strong> ${content}
                ${sourceHtml}
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Hi·ªÉn th·ªã tr·∫°ng th√°i g√µ
        function showTyping() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing';
            typingDiv.className = 'message ai';
            typingDiv.innerHTML = '<strong>ü§ñ AI Agent:</strong> <span class="loading-spinner"></span> ƒêang t√¨m ki·∫øm...';
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ·∫®n tr·∫°ng th√°i g√µ
        function hideTyping() {
            const typingElement = document.getElementById('typing');
            if (typingElement) {
                typingElement.remove();
            }
        }

        // Hi·ªÉn th·ªã tr·∫°ng th√°i
        function showStatus(type, message) {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng t√†i li·ªáu
        function updateDocsCount() {
            document.getElementById('docsCount').innerHTML = 
                `<strong>üìä T√†i li·ªáu:</strong> ${systemState.documents.length} files`;
        }

        // X·ª≠ l√Ω ph√≠m Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Kh·ªüi t·∫°o ban ƒë·∫ßu
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('language').addEventListener('change', function() {
                systemState.currentLanguage = this.value;
            });

            // Auto-resize textarea n·∫øu c·∫ßn
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });

            // Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n ban ƒë·∫ßu
            updateDocsCount();
        });
    </script>
</body>
</html>
